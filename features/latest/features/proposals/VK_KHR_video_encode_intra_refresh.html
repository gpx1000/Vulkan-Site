<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>VK_KHR_video_encode_intra_refresh :: Vulkan Documentation Project</title>
    <meta name="generator" content="Antora 3.1.10">
    <script>
      !function (theme) {
        if (theme === 'dark') document.documentElement.classList.add('dark')
        else document.documentElement.classList.add('light')
      }(localStorage && localStorage.getItem('theme') || (matchMedia('(prefers-color-scheme: dark)')?.matches && 'dark'))
    </script>
    <link rel="stylesheet" href="../../../../_/css/site.css">
    <link rel="stylesheet" href="../../../../_/css/vendor/tabs.css">
    <link rel="apple-touch-icon" sizes="180x180" href="../../../../_/img/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../../../_/img/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../../../_/img/favicon-16x16.png">
    <link rel="manifest" href="../../../../_/site.webmanifest">
    <link rel="mask-icon" href="../../../../_/img/safari-pinned-tab.svg" color="#a41e22">
    <meta name="msapplication-TileColor" content="#ffc40d">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../../.."><img class="navbar-item" alt="Vulkan White Label" src="../../../../_/Vulkan_Docs.svg" /></a>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field has-filter">
          <label for="search-input"></label>
          <input id="search-input" type="text" placeholder="Search the docs">
          <label class="filter checkbox">
            <input type="checkbox" data-facet-filter="component:features" checked> In this component
          </label>
        </div>
      </div>
      <button class="navbar-burger" aria-controls="topbar-nav" aria-expanded="false" aria-label="Toggle main menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <!-- <a class="navbar-item" href="#">Home</a> -->
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Specs</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="../../../../spec/latest/chapters/introduction.html">Vulkan API</a>
            <a class="navbar-item" href="../../../../glsl/latest/index.html">GLSL</a>
            <a class="navbar-item" href="../../../../guide/latest/hlsl.html">HLSL</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Education</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="../../../../refpages/latest/refpages/index.html">Vulkan Reference Pages</a>
            <a class="navbar-item" href="../../../../features/latest/features/index.html">Vulkan Feature Descriptions</a>
            <a class="navbar-item" href="../../../../guide/latest/index.html">Vulkan Guide</a>
            <a class="navbar-item" href="../../../../samples/latest/README.html">Vulkan Samples</a>
            <a class="navbar-item" href="../../../../tutorial/latest/index.html">Vulkan Tutorial</a>
            <a class="navbar-item" href="https://www.youtube.com/c/vulkan">YouTube</a>
            <a class="navbar-item" href="https://vulkan.org">More Info at Vulkan.org</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Feedback</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="https://github.com/KhronosGroup/Vulkan-Site/issues/new/choose" target="_blank">Report a Problem</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Community</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="https://discord.gg/vulkan">Vulkan Discord</a>
            <a class="navbar-item" href="https://reddit.com/r/vulkan">Reddit</a>
            <a class="navbar-item" href="https://stackoverflow.com/questions/tagged/vulkan">Stack Overflow</a>
            <a class="navbar-item" href="https://fosstodon.org/@vulkan">Mastodon</a>
          </div>
        </div>
      </div>
    </div>
    <label class="theme-toggler">
      <input type="checkbox" id="switch-theme-checkbox" name="switch-theme-checkbox"/>
      <span class="icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="moon" class="svg-inline--fa fa-moon moon" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path fill="currentColor" d="M223.5 32C100 32 0 132.3 0 256S100 480 223.5 480c60.6 0 115.5-24.2 155.8-63.4c5-4.9 6.3-12.5 3.1-18.7s-10.1-9.7-17-8.5c-9.8 1.7-19.8 2.6-30.1 2.6c-96.9 0-175.5-78.8-175.5-176c0-65.8 36-123.1 89.3-153.3c6.1-3.5 9.2-10.5 7.7-17.3s-7.3-11.9-14.3-12.5c-6.3-.5-12.6-.8-19-.8z"></path>
        </svg>
        <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="sun" class="svg-inline--fa fa-sun sun" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M361.5 1.2c5 2.1 8.6 6.6 9.6 11.9L391 121l107.9 19.8c5.3 1 9.8 4.6 11.9 9.6s1.5 10.7-1.6 15.2L446.9 256l62.3 90.3c3.1 4.5 3.7 10.2 1.6 15.2s-6.6 8.6-11.9 9.6L391 391 371.1 498.9c-1 5.3-4.6 9.8-9.6 11.9s-10.7 1.5-15.2-1.6L256 446.9l-90.3 62.3c-4.5 3.1-10.2 3.7-15.2 1.6s-8.6-6.6-9.6-11.9L121 391 13.1 371.1c-5.3-1-9.8-4.6-11.9-9.6s-1.5-10.7 1.6-15.2L65.1 256 2.8 165.7c-3.1-4.5-3.7-10.2-1.6-15.2s6.6-8.6 11.9-9.6L121 121 140.9 13.1c1-5.3 4.6-9.8 9.6-11.9s10.7-1.5 15.2 1.6L256 65.1 346.3 2.8c4.5-3.1 10.2-3.7 15.2-1.6zM160 256a96 96 0 1 1 192 0 96 96 0 1 1 -192 0zm224 0a128 128 0 1 0 -256 0 128 128 0 1 0 256 0z"></path>
        </svg></span>
    </label>
  </nav>
</header>
<script>
  window.onload = function() {
    let e = document.getElementById("switch-theme-checkbox")
    e.checked = document.documentElement.classList.contains("dark");
    e.checked ? e.parentElement.classList.add("active") : e.parentElement.classList.remove("active")
  }
  !function() {
    let e = document.getElementById("switch-theme-checkbox")
    e.checked = document.documentElement.classList.contains("dark")
    e.addEventListener("change", function() {
      if (document.documentElement.classList.contains("light")) {
        document.documentElement.classList.remove("light")
        document.documentElement.classList.add("dark")
      } else if (document.documentElement.classList.contains("dark")) {
        document.documentElement.classList.remove("dark")
        document.documentElement.classList.add("light")
      } else {
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
          document.documentElement.classList.add("dark")
        } else {
          document.documentElement.classList.add("light")
        }
      }
      document.documentElement.setAttribute("data-theme", this.checked ? "dark" : "light"),
        function(e) {
          window.localStorage && window.localStorage.setItem("theme", e)
        }(this.checked ? "dark" : "light"), this.checked ? this.parentElement.classList.add("active") : this.parentElement.classList.remove("active")
    }.bind(e))
  }();
</script>
<div class="body">
<div class="nav-container" data-component="features" data-version="latest" id="split-0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all" style="display: none"></button>
    <h3 class="title"><a href="../index.html">Vulkan Feature Descriptions</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Vulkan Roadmap and Feature Descriptions</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="Roadmap.html">Vulkan Roadmap</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Feature Descriptions</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_AMDX_dense_geometry_format.html">VK_AMDX_dense_geometry_format</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_AMDX_shader_enqueue.html">VK_AMDX_shader_enqueue</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_AMD_anti_lag.html">VK_AMD_anti_lag</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_AMD_shader_early_and_late_fragment_tests.html">VK_AMD_shader_early_and_late_fragment_tests</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_ANDROID_external_format_resolve.html">VK_ANDROID_external_format_resolve</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_ARM_performance_counters_by_region.html">VK_ARM_performance_counters_by_region</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_ARM_pipeline_opacity_micromap.html">VK_ARM_pipeline_opacity_micromap</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_ARM_render_pass_striped.html">VK_ARM_render_pass_striped</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_ARM_tensors.html">VK_ARM_tensors</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_attachment_feedback_loop_dynamic_state.html">VK_EXT_attachment_feedback_loop_dynamic_state</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_attachment_feedback_loop_layout.html">VK_EXT_attachment_feedback_loop_layout</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_calibrated_timestamps.html">VK_EXT_calibrated_timestamps</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_custom_resolve.html">VK_EXT_custom_resolve</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_depth_bias_control.html">VK_EXT_depth_bias_control</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_depth_clamp_control.html">VK_EXT_depth_clamp_control</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_descriptor_buffer.html">VK_EXT_descriptor_buffer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_device_fault.html">VK_EXT_device_fault</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_device_generated_commands.html">VK_EXT_device_generated_commands</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_dynamic_rendering_unused_attachments.html">VK_EXT_dynamic_rendering_unused_attachments</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_extended_dynamic_state3.html">VK_EXT_extended_dynamic_state3</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_external_memory_acquire_unmodified.html">VK_EXT_external_memory_acquire_unmodified</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_external_memory_metal.html">VK_EXT_external_memory_metal</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_fragment_density_map_offset.html">VK_EXT_fragment_density_map_offset</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_frame_boundary.html">Proposal: <code>VK_EXT_frame_boundary</code></a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_graphics_pipeline_library.html">VK_EXT_graphics_pipeline_library</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_host_image_copy.html">VK_EXT_host_image_copy</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_image_2d_array_of_3d.html">VK_EXT_image_2d_array_of_3d</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_image_compression_control.html">VK_EXT_image_compression_control</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_image_sliced_view_of_3d.html">VK_EXT_image_sliced_view_of_3d</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_layer_settings.html">VK_EXT_layer_settings</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_legacy_dithering.html">VK_EXT_legacy_dithering</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_legacy_vertex_attributes.html">VK_EXT_legacy_vertex_attributes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_map_memory_placed.html">VK_EXT_map_memory_placed</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_memory_decompression.html">VK_EXT_memory_decompression</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_mesh_shader.html">VK_EXT_mesh_shader</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_metal_objects.html">VK_EXT_metal_objects</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_multisampled_render_to_single_sampled.html">VK_EXT_multisampled_render_to_single_sampled</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_mutable_descriptor_type.html">VK_EXT_mutable_descriptor_type</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_non_seamless_cube_map.html">VK_EXT_non_seamless_cube_map</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_opacity_micromap.html">VK_EXT_opacity_micromap</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_pipeline_library_group_handles.html">VK_EXT_pipeline_library_group_handles</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_pipeline_protected_access.html">VK_EXT_pipeline_protected_access</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_present_mode_fifo_latest_ready.html">VK_EXT_present_mode_fifo_latest_ready</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_present_timing.html">VK_EXT_present_timing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_primitives_generated_query.html">VK_EXT_primitives_generated_query</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_rasterization_order_attachment_access.html">VK_EXT_rasterization_order_attachment_access</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_ray_tracing_invocation_reorder.html">VK_EXT_ray_tracing_invocation_reorder</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_shader_64bit_indexing.html">VK_EXT_shader_64bit_indexing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_shader_float8.html">VK_EXT_shader_float8</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_shader_module_identifier.html">VK_EXT_shader_module_identifier</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_shader_object.html">VK_EXT_shader_object</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_shader_replicated_composites.html">VK_EXT_shader_replicated_composites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_shader_tile_image.html">VK_EXT_shader_tile_image</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_shader_uniform_buffer_unsized_array.html">VK_EXT_shader_uniform_buffer_unsized_array</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_subpass_merge_feedback.html">VK_EXT_subpass_merge_feedback</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_surface_maintenance1.html">VK_EXT_surface_maintenance1</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_swapchain_maintenance1.html">VK_EXT_swapchain_maintenance1</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_EXT_zero_initialize_device_memory.html">VK_EXT_zero_initialize_device_memory</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_GOOGLE_surfaceless_query.html">VK_GOOGLE_surfaceless_query</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_HUAWEI_cluster_culling_shader.html">VK_HUAWEI_cluster_culling_shader</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_HUAWEI_invocation_mask.html">VK_HUAWEI_invocation_mask</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_compute_shader_derivatives.html">VK_KHR_compute_shader_derivatives</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_cooperative_matrix.html">VK_KHR_cooperative_matrix</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_copy_memory_indirect.html">VK_KHR_copy_memory_indirect</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_dynamic_rendering.html">VK_KHR_dynamic_rendering</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_dynamic_rendering_local_read.html">VK_KHR_dynamic_rendering_local_read</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_fragment_shader_barycentric.html">VK_KHR_fragment_shader_barycentric</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_fragment_shading_rate.html">VK_KHR_fragment_shading_rate</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_load_store_op_none.html">VK_KHR_load_store_op_none</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_maintenance10.html">VK_KHR_maintenance10</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_maintenance5.html">VK_KHR_maintenance5</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_maintenance6.html">VK_KHR_maintenance6</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_maintenance7.html">VK_KHR_maintenance7</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_maintenance8.html">VK_KHR_maintenance8</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_maintenance9.html">VK_KHR_maintenance9</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_map_memory2.html">VK_KHR_map_memory2</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_pipeline_binary.html">VK_KHR_pipeline_binary</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_present_id2.html">VK_KHR_present_id2</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_present_mode_fifo_latest_ready.html">VK_KHR_present_mode_fifo_latest_ready</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_present_wait2.html">VK_KHR_present_wait2</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_ray_tracing_position_fetch.html">VK_KHR_ray_tracing_position_fetch</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_shader_bfloat16.html">VK_KHR_shader_bfloat16</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_shader_expect_assume.html">VK_KHR_shader_expect_assume</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_shader_float_controls2.html">VK_KHR_shader_float_controls2</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_shader_fma.html">VK_KHR_shader_fma</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_shader_integer_dot_product.html">VK_KHR_shader_integer_dot_product</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_shader_maximal_reconvergence.html">VK_KHR_shader_maximal_reconvergence</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_shader_quad_control.html">VK_KHR_shader_quad_control</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_shader_relaxed_extended_instruction.html">VK_KHR_shader_relaxed_extended_instruction</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_shader_subgroup_rotate.html">Subgroup rotation instruction</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_shader_untyped_pointers.html">VK_KHR_shader_untyped_pointers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_surface_maintenance1.html">VK_KHR_surface_maintenance1</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_swapchain_maintenance1.html">VK_KHR_swapchain_maintenance1</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_unified_image_layouts.html">VK_KHR_unified_image_layouts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_vertex_attribute_divisor.html">VK_KHR_vertex_attribute_divisor</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_video_decode_av1.html">VK_KHR_video_decode_av1</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_video_decode_h264.html">VK_KHR_video_decode_h264</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_video_decode_h265.html">VK_KHR_video_decode_h265</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_video_decode_queue.html">VK_KHR_video_decode_queue</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_video_decode_vp9.html">VK_KHR_video_decode_vp9</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_video_encode_av1.html">VK_KHR_video_encode_av1</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_video_encode_h264.html">VK_KHR_video_encode_h264</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_video_encode_h265.html">VK_KHR_video_encode_h265</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="VK_KHR_video_encode_intra_refresh.html">VK_KHR_video_encode_intra_refresh</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_video_encode_quantization_map.html">VK_KHR_video_encode_quantization_map</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_video_encode_queue.html">VK_KHR_video_encode_queue</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_video_maintenance1.html">VK_KHR_video_maintenance1</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_video_maintenance2.html">VK_KHR_video_maintenance2</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_KHR_video_queue.html">VK_KHR_video_queue</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_LUNARG_direct_driver_loading.html">VK_LUNARG_direct_driver_loading</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_MSFT_layered_driver.html">VK_MSFT_layered_driver</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_NV_cluster_acceleration_structure.html">VK_NV_cluster_acceleration_structure</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_NV_cooperative_matrix2.html">VK_NV_cooperative_matrix2</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_NV_cooperative_vector.html">VK_NV_cooperative_vector</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_NV_display_stereo.html">VK_NV_display_stereo</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_NV_external_compute_queue.html">VK_NV_external_compute_queue</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_NV_partitioned_acceleration_structure.html">VK_NV_partitioned_acceleration_structure</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_NV_ray_tracing_linear_swept_spheres.html">VK_NV_ray_tracing_linear_swept_spheres</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_NV_ray_tracing_validation.html">VK_NV_ray_tracing_validation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_QCOM_data_graph_model.html">VK_QCOM_data_graph_model</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_QCOM_image_processing.html">VK_QCOM_image_processing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_QCOM_tile_memory_heap.html">VK_QCOM_tile_memory_heap</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_QCOM_tile_properties.html">VK_QCOM_tile_properties</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_QCOM_tile_shading.html">VK_QCOM_tile_shading</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VK_VERSION_1_4.html">Vulkan 1.4</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="VulkanBase.html">Vulkan Base</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Vulkan Feature Descriptions</span>
    <span class="version">latest</span>
  </div>
  <ul class="components">
    <li class="component">
      <div class="title"><a href="../../../../tutorial/latest/00_Introduction.html">Khronos Vulkan Tutorial</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../tutorial/latest/00_Introduction.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../../glsl/latest/index.html">OpenGL Shading Language Specification</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../glsl/latest/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../../refpages/latest/refpages/index.html">Vulkan API Reference Pages</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../refpages/latest/refpages/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <div class="title"><a href="../index.html">Vulkan Feature Descriptions</a></div>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../../guide/latest/index.html">Vulkan Guide</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../guide/latest/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../../samples/latest/README.html">Vulkan Samples</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../samples/latest/README.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <div class="title"><a href="../../../../spec/latest/index.html">Vulkan Specification</a></div>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../spec/latest/index.html">latest</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article" id="split-1">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../../spec/latest/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Vulkan Feature Descriptions</a></li>
    <li>Feature Descriptions</li>
    <li><a href="VK_KHR_video_encode_intra_refresh.html">VK_KHR_video_encode_intra_refresh</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">VK_KHR_video_encode_intra_refresh</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_problem_statement">1. Problem statement</a></li>
<li><a href="#_solution_space">2. Solution Space</a></li>
<li><a href="#_proposal">3. Proposal</a>
<ul class="sectlevel2">
<li><a href="#_new_video_profile_capabilities">3.1. New Video Profile Capabilities</a></li>
<li><a href="#_codec_specific_details">3.2. Codec-Specific Details</a></li>
<li><a href="#_using_intra_refresh">3.3. Using Intra Refresh</a></li>
</ul>
</li>
<li><a href="#_examples">4. Examples</a>
<ul class="sectlevel2">
<li><a href="#_creating_a_video_encode_session_with_intra_refresh_support">4.1. Creating a video encode session with intra refresh support</a></li>
<li><a href="#_encode_a_typical_intra_refresh_frame_referring_to_the_previous_intra_refreshed_frame">4.2. Encode a typical intra refresh frame referring to the previous intra-refreshed frame</a></li>
</ul>
</li>
<li><a href="#_issues">5. Issues</a>
<ul class="sectlevel2">
<li><a href="#_resolved_is_intra_refresh_performed_per_slice_segment">5.1. RESOLVED: Is intra refresh performed per slice (segment)?</a></li>
<li><a href="#_resolved_are_the_actual_extents_of_intra_refresh_regions_exposed_to_the_application">5.2. RESOLVED: Are the actual extents of intra refresh regions exposed to the application?</a></li>
<li><a href="#_resolved_should_we_require_the_slice_segment_count_to_match_used_the_intra_refresh_cycle_duration">5.3. RESOLVED: Should we require the slice (segment) count to match used the intra refresh cycle duration?</a></li>
<li><a href="#_resolved_should_we_provide_a_query_for_the_application_to_determine_the_location_and_extent_of_intra_refresh_regions">5.4. RESOLVED: Should we provide a query for the application to determine the location and extent of intra refresh regions?</a></li>
<li><a href="#_resolved_can_specific_intra_refresh_regions_for_a_given_coded_extent_and_intra_refresh_cycle_duration_be_empty">5.5. RESOLVED: Can specific intra refresh regions for a given coded extent and intra refresh cycle duration be empty?</a></li>
<li><a href="#_resolved_should_we_enforce_with_valid_usage_clauses_that_the_intra_refresh_cycle_is_completed_in_exactly_intrarefreshcycleduration_number_of_frames_with_subsequent_intrarefreshindex_values">5.6. RESOLVED: Should we enforce with valid usage clauses that the intra refresh cycle is completed in exactly <code>intraRefreshCycleDuration</code> number of frames with subsequent <code>intraRefreshIndex</code> values?</a></li>
<li><a href="#_resolved_should_we_restrict_referencing_during_an_intra_refresh_cycle_to_the_previously_encoded_frame">5.7. RESOLVED: Should we restrict referencing during an intra refresh cycle to the previously encoded frame?</a></li>
<li><a href="#_resolved_are_there_any_restrictions_on_the_encoded_picture_types_that_can_be_used_with_intra_refresh">5.8. RESOLVED: Are there any restrictions on the encoded picture types that can be used with intra refresh?</a></li>
<li><a href="#_resolved_should_we_allow_pictures_encoded_without_intra_refresh_to_have_active_reference_pictures_with_dirty_intra_refresh_regions">5.9. RESOLVED: Should we allow pictures encoded without intra refresh to have active reference pictures with dirty intra refresh regions?</a></li>
</ul>
</li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This document outlines a proposal that enables intra refresh in video encode operations.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_problem_statement"><a class="anchor" href="#_problem_statement"></a>1. Problem statement</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Inserting intra-only frames (frames that do not depend on reference frames) in the video stream and then not referencing frames before such an intra-only frame in subsequent frames in decoding order enables application to make sure that transmission and/or decoding errors do not propagate across such intra-only frame boundaries. Some video compression standards refer to this technique as "instantaneous decoder refresh".</p>
</div>
<div class="paragraph">
<p>While this technique solves the problem of error propagation, intra-only frames are usually much larger, in terms of encoded bitstream size, compared to frames that take advantage of inter-frame prediction. This could result in spikes in the bitrate usage which is undesirable for streaming and other use cases that depend on or prefer a more uniform bitrate usage.</p>
</div>
<div class="paragraph">
<p>Intra refresh is a technique where decoder refresh is done through a series of frames instead of a single frame. This is achieved by refreshing the entire coded extent of the stream one image subregion at a time, while also making sure that other, already refreshed regions of the frame that use inter-frame prediction, do not use any data in dirty (unrefreshed) regions of reference frames for prediction. This enables applications to avoid error propagation across intra refresh cycles without introducing sudden spikes in the bitstream usage as the cost of the refresh is amortized across a series of subsequent frames.</p>
</div>
<div class="paragraph">
<p>This proposal introduces APIs necessary for reliably implementing intra refresh in video encode sessions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_solution_space"><a class="anchor" href="#_solution_space"></a>2. Solution Space</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following new controls have been considered for inclusion in this proposal:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enable applications to select the region of a frame that is requested to be intra refreshed (i.e. encoded with intra blocks)</p>
</li>
<li>
<p>Enable applications to restrict the regions of reference frames that can be used for prediction of already refreshed regions in order to ensure that no error propagation happens across intra refresh cycles as a result of using dirty (unrefreshed) reference data for prediction</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The video encode APIs already provide some controls that enable (1). In particular, the H.264 and H.265 encode APIs allow coding individual H.264 slices and H.265 slice segments of a frame, respectively, as I slices. This, however, is not sufficient to reliably implement intra refresh for the following reasons:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It does not solve (2), i.e. it does not enable restricting reference prediction to already refreshed regions</p>
</li>
<li>
<p>Not all implementations can do per-slice (segment) intra refresh, some implementations split the frame into intra refresh regions in other ways (e.g. coding block columns or rows)</p>
</li>
<li>
<p>Many implementations can do intra refresh even when the frame is not split into multiple slices or slice segments</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This justifies the definition of intra refresh regions to be orthogonal to frame slices or slice segments, at least in the general case. Furthermore, the way the coded extent is split into intra refresh regions varies across implementations, often according to complex implementation-specific and coded extent dependent rules. Accordingly, this proposal does not mandate or define the rules of how an implementation splits the coded extent into intra refresh regions.</p>
</div>
<div class="paragraph">
<p>Such an abstract definition of intra refresh regions enables both application and implementation portability, and also makes it simpler to provide a solution for (2) that fits the limitations of implementations when it comes to restricting the reference frame regions usable for inter-frame prediction of already refreshed regions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_proposal"><a class="anchor" href="#_proposal"></a>3. Proposal</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following new concepts are introduced:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Intra refresh cycle - a series of frames that use intra refresh to perform decoder refresh of the entire coded extent</p>
</li>
<li>
<p>Intra refresh cycle duration - the number of frames across which decoder refresh of the entire coded extent completes and, inherently, the number of intra refresh regions the coded extent is split into</p>
</li>
<li>
<p>Intra refresh index - the ordinal index of the frame participating in the intra refresh cycle (between zero, inclusive, and the intra refresh cycle duration, exclusive)</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_new_video_profile_capabilities"><a class="anchor" href="#_new_video_profile_capabilities"></a>3.1. New Video Profile Capabilities</h3>
<div class="paragraph">
<p>Intra refresh capabilities can be retrieved by including the following new structure in the <code>pNext</code> chain of <code>VkVideoCapabilitiesKHR</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">typedef struct VkVideoEncodeIntraRefreshCapabilitiesKHR {
    VkStructureType                       sType;
    void*                                 pNext;
    VkVideoEncodeIntraRefreshModeFlagsKHR intraRefreshModes;
    uint32_t                              maxIntraRefreshCycleDuration;
    uint32_t                              maxIntraRefreshActiveReferencePictures;
    VkBool32                              partitionIndependentIntraRefreshRegions;
    VkBool32                              nonRectangularIntraRefreshRegions;
} VkVideoEncodeIntraRefreshCapabilitiesKHR;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>intraRefreshModes</code> is a bitmask indicating the supported intra refresh modes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VK_VIDEO_ENCODE_INTRA_REFRESH_MODE_PER_PICTURE_PARTITION_BIT_KHR</code> indicates support for performing intra refresh per picture partition (e.g. per H.264 slice or per H.265 slice segment), one picture partition at a time</p>
</li>
<li>
<p><code>VK_VIDEO_ENCODE_INTRA_REFRESH_MODE_BLOCK_BASED_BIT_KHR</code> indicates support for block-based intra refresh, at the granularity of implementation-defined groups of coding blocks</p>
</li>
<li>
<p><code>VK_VIDEO_ENCODE_INTRA_REFRESH_MODE_BLOCK_ROW_BASED_BIT_KHR</code> indicates support for row-based intra refresh, at the granularity of implementation-defined groups of coding block rows</p>
</li>
<li>
<p><code>VK_VIDEO_ENCODE_INTRA_REFRESH_MODE_BLOCK_COLUMN_BASED_BIT_KHR</code> indicates support for column-based intra refresh, at the granularity of implementation-defined groups of coding block columns</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>maxIntraRefreshCycleDuration</code> is the maximum intra refresh cycle duration, in terms of number of frames, that the implementation supports.</p>
</div>
<div class="paragraph">
<p><code>maxIntraRefreshActiveReferencePictures</code> is the maximum number of active reference pictures that can be used when the current picture is encoded with intra refresh or it uses active reference pictures encoded with intra refresh.</p>
</div>
<div class="paragraph">
<p><code>partitionIndependentIntraRefreshRegions</code> indicates whether the implementation supports intra refresh regions that are independent of the picture partitioning used during encoding. If it is <code>VK_FALSE</code>, then pictures cannot be encoded with multiple picture partitions (e.g. H.264 slices or H.265 slice segments) with any intra refresh mode other than <code>VK_VIDEO_ENCODE_INTRA_REFRESH_MODE_PER_PICTURE_PARTITION_BIT_KHR</code>. If it is <code>VK_TRUE</code>, then pictures can be encoded with multiple picture partitions, independent of the used intra refresh mode.</p>
</div>
<div class="paragraph">
<p><code>nonRectangularIntraRefreshRegions</code> indicates whether the implementation supports non-rectangular intra refresh regions. If it is <code>VK_FALSE</code>, then intra refresh regions can only be rectangular which may limit the intra refresh cycle duration to values that allow for the coded extent to be split into rectangular intra refresh regions according to the used intra refresh mode, typically restricting the intra refresh regions to entire coding block rows or columns.</p>
</div>
</div>
<div class="sect2">
<h3 id="_codec_specific_details"><a class="anchor" href="#_codec_specific_details"></a>3.2. Codec-Specific Details</h3>
<div class="paragraph">
<p>This section describes the codec-specific details related to intra refresh.</p>
</div>
<div class="sect3">
<h4 id="_h_264_encode"><a class="anchor" href="#_h_264_encode"></a>3.2.1. H.264 Encode</h4>
<div class="paragraph">
<p>This proposal introduces a new H.264 encode capability flag called <code>VK_VIDEO_ENCODE_H264_CAPABILITY_B_PICTURE_INTRA_REFRESH_BIT_KHR</code> indicating support for encoding B pictures with intra refresh.
Encoding B pictures with intra refresh enabled is only supported if this capability flag is reported for the used H.264 encode profile.</p>
</div>
<div class="paragraph">
<p>When using the <code>VK_VIDEO_ENCODE_INTRA_REFRESH_MODE_PER_PICTURE_PARTITION_BIT_KHR</code> intra refresh mode, then the used intra refresh duration must always match the number of H.264 slices the frames are encoded with.</p>
</div>
<div class="paragraph">
<p>When using any of the other intra refresh modes and <code>partitionIndependentIntraRefreshRegions</code> is not supported, then pictures can only be encoded with a single H.264 slice.</p>
</div>
</div>
<div class="sect3">
<h4 id="_h_265_encode"><a class="anchor" href="#_h_265_encode"></a>3.2.2. H.265 Encode</h4>
<div class="paragraph">
<p>This proposal introduces a new H.265 encode capability flag called <code>VK_VIDEO_ENCODE_H265_CAPABILITY_B_PICTURE_INTRA_REFRESH_BIT_KHR</code> indicating support for encoding B pictures with intra refresh.
Encoding B pictures with intra refresh enabled is only supported if this capability flag is reported for the used H.265 encode profile.</p>
</div>
<div class="paragraph">
<p>When using the <code>VK_VIDEO_ENCODE_INTRA_REFRESH_MODE_PER_PICTURE_PARTITION_BIT_KHR</code> intra refresh mode, then the used intra refresh duration must always match the number of H.265 slice segments the frames are encoded with.</p>
</div>
<div class="paragraph">
<p>When using any of the other intra refresh modes and <code>partitionIndependentIntraRefreshRegions</code> is not supported, then pictures can only be encoded with a single H.265 slice segment.</p>
</div>
</div>
<div class="sect3">
<h4 id="_av1_encode"><a class="anchor" href="#_av1_encode"></a>3.2.3. AV1 Encode</h4>
<div class="paragraph">
<p>This proposal introduces a new AV1 encode capability flag called <code>VK_VIDEO_ENCODE_AV1_CAPABILITY_COMPOUND_PREDICTION_INTRA_REFRESH_BIT_KHR</code> indicating support for encoding frames using compound prediction modes with intra refresh.
Encoding frames using (uni- or bidirectional) compound prediction mode with intra refresh enabled is only supported if this capability flag is reported for the used AV1 encode profile.</p>
</div>
<div class="paragraph">
<p>In case of AV1 encode, the partitioning of the encoded picture into AV1 tiles is not entirely controlled by the application. While the application can specify the preferred tile partitioning for the encoded picture, the implementation is allowed to override that partitioning in order to accommodate for implementation limitations.</p>
</div>
<div class="paragraph">
<p>Accordingly, there are no specific restrictions imposed on the application when using the <code>VK_VIDEO_ENCODE_INTRA_REFRESH_MODE_PER_PICTURE_PARTITION_BIT_KHR</code> intra refresh mode with an AV1 encode profile supporting it, but using this intra refresh mode may impose further restrictions on the way the implementation can perform the partitioning of the encoded pictures into AV1 tiles.</p>
</div>
<div class="paragraph">
<p>In a similar vein, the <code>partitionIndependentIntraRefreshRegions</code> capability is only indicative for AV1 encode profiles.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_intra_refresh"><a class="anchor" href="#_using_intra_refresh"></a>3.3. Using Intra Refresh</h3>
<div class="paragraph">
<p>Applications have to opt in to using intra refresh in a video session by including the following new structure in the <code>pNext</code> chain of <code>VkVideoSessionCreateInfoKHR</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">typedef struct VkVideoEncodeSessionIntraRefreshCreateInfoKHR {
    VkStructureType                           sType;
    const void*                               pNext;
    VkVideoEncodeIntraRefreshModeFlagBitsKHR  intraRefreshMode;
} VkVideoEncodeSessionIntraRefreshCreateInfoKHR;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>intraRefreshMode</code> specifies the intra refresh mode to use in the video session.</p>
</div>
<div class="paragraph">
<p>Applications have to opt in to using intra refresh by specifying the new <code>VK_VIDEO_ENCODE_INTRA_REFRESH_BIT_KHR</code> flag in <code>VkVideoEncodeInfoKHR::flags</code> and including the following new structure in the <code>pNext</code> chain of <code>VkVideoEncodeInfoKHR</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">typedef struct VkVideoEncodeIntraRefreshInfoKHR {
    VkStructureType       sType;
    const void*           pNext;
    uint32_t              intraRefreshCycleDuration;
    uint32_t              intraRefreshIndex;
} VkVideoEncodeIntraRefreshInfoKHR;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>intraRefreshCycleDuration</code> specifies the used intra refresh cycle duration. During an intra refresh cycle, this value is expected to match across the frames participating in the intra refresh cycle, but can change between subsequent intra refresh cycles.</p>
</div>
<div class="paragraph">
<p><code>intraRefreshIndex</code> specifies the ordinal index of the encoded frame within the intra refresh cycle and is expected to be between 0 and <code>intraRefreshCycleDuration</code>-1. If <code>VK_VIDEO_ENCODE_INTRA_REFRESH_BIT_KHR</code> is not specified in <code>VkVideoEncodeInfoKHR::flags</code>, then the value of <code>intraRefreshIndex</code> is ignored.</p>
</div>
<div class="paragraph">
<p>In order to restrict reference prediction to already refreshed regions, the application needs to include the following new structure in the <code>pNext</code> chain of the corresponding element of <code>VkVideoEncodeInfoKHR::pReferenceSlots</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">typedef struct VkVideoReferenceIntraRefreshInfoKHR {
    VkStructureType       sType;
    const void*           pNext;
    uint32_t              dirtyIntraRefreshRegions;
} VkVideoReferenceIntraRefreshInfoKHR;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>dirtyIntraRefreshRegions</code> specifies the number of intra refresh regions that are still dirty (not refreshed), with respect to the currently used intra refresh cycle duration. In practice, for a given intra refresh cycle, the <code>dirtyIntraRefreshRegions</code> of a reference frame is one less than the difference of the <code>intraRefreshCycleDuration</code> and <code>intraRefreshIndex</code> used to encode that frame (i.e. <code>dirtyIntraRefreshRegions = intraRefreshCycleDuration - intraRefreshIndex - 1</code>). When this structure is not specified, a <code>dirtyIntraRefreshRegions</code> value of zero is assumed, as usual.</p>
</div>
<div class="paragraph">
<p><code>dirtyIntraRefreshRegions</code> can only be non-zero if the current frame is encoded with intra refresh and this proposal only allows using partially dirty references that refer to the previous frame within the intra refresh cycle, i.e. <code>dirtyIntraRefreshRegions</code> of any partially dirty references must equal <code>intraRefreshCycleDuration - intraRefreshIndex</code> where <code>intraRefreshIndex</code> is the index of the current frame within the intra refresh cycle. This, however, does not limit including additional reference frames with zero <code>dirtyIntraRefreshRegions</code>.</p>
</div>
<div class="paragraph">
<p>It is expected that the reference frame was encoded with the same intra refresh cycle duration, otherwise incorrect data may end up being used for sample prediction, as the intra refresh cycle duration and the corresponding intra refresh region splitting is expected to be invariant for the duration of the intra refresh cycle.</p>
</div>
<div class="paragraph">
<p>The rules for reference prediction for a given intra refresh region <code>i</code> of a frame encoded with intra refresh are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If <code>i</code> is less than the <code>intraRefreshIndex</code> of the encoded frame, then prediction is not allowed based on any intra refresh region <code>j</code> of a reference if <code>j</code> is greater than or equal to the difference of <code>intraRefreshCycleDuration</code> and <code>dirtyIntraRefreshRegions</code> of that reference (clean regions cannot be predicted with a dirty region)</p>
</li>
<li>
<p>If <code>i</code> is greater than the <code>intraRefreshIndex</code> of the encoded frame, then prediction is allowed based on any intra refresh region of any reference (dirty regions can be predicted with either clean or dirty region)</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_examples"><a class="anchor" href="#_examples"></a>4. Examples</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_creating_a_video_encode_session_with_intra_refresh_support"><a class="anchor" href="#_creating_a_video_encode_session_with_intra_refresh_support"></a>4.1. Creating a video encode session with intra refresh support</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">VkVideoSessionKHR videoSession = VK_NULL_HANDLE;

VkVideoEncodeSessionIntraRefreshCreateInfoKHR intraRefreshCreateInfo = {
    .sType = VK_STRUCTURE_TYPE_VIDEO_ENCODE_SESSION_INTRA_REFRESH_CREATE_INFO_KHR,
    .pNext = NULL,
    .intraRefreshMode = ... // one of the supported intra refresh modes
};

VkVideoSessionCreateInfoKHR createInfo = {
    .sType = VK_STRUCTURE_TYPE_VIDEO_SESSION_CREATE_INFO_KHR,
    .pNext = intraRefreshCreateInfo,
    ...
};

vkCreateVideoSessionKHR(device, &amp;createInfo, NULL, &amp;videoSession);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_encode_a_typical_intra_refresh_frame_referring_to_the_previous_intra_refreshed_frame"><a class="anchor" href="#_encode_a_typical_intra_refresh_frame_referring_to_the_previous_intra_refreshed_frame"></a>4.2. Encode a typical intra refresh frame referring to the previous intra-refreshed frame</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c hljs" data-lang="c">vkCmdBeginVideoCodingKHR(commandBuffer, ...);

VkVideoEncodeIntraRefreshInfoKHR intraRefreshInfo = {
    .sType = VK_STRUCTURE_TYPE_VIDEO_ENCODE_H264_PICTURE_INFO_KHR,
    .pNext = ... // pointer to codec-specific picture information structure
    .intraRefreshCycleDuration = ... // used intra refresh cycle duration (fixed for a single cycle)
    .intraRefreshIndex = ... // ordinal index of the frame within the intra refresh cycle
};

VkVideoReferenceIntraRefreshInfoKHR referenceIntraRefreshInfo = {
    .sType = VK_STRUCTURE_TYPE_VIDEO_REFERENCE_INTRA_REFRESH_INFO_KHR,
    .pNext = ... // pointer to codec-specific reference picture information structure
    .dirtyIntraRefreshRegions = intraRefreshInfo.intraRefreshCycleDuration - intraRefreshInfo.intraRefreshIndex
};

VkVideoReferenceSlotInfoKHR referenceSlotInfo = {
    .sType = VK_STRUCTURE_TYPE_VIDEO_REFERENCE_SLOT_INFO_KHR,
    .pNext = &amp;referenceIntraRefreshInfo,
    ...
};

VkVideoEncodeInfoKHR encodeInfo = {
    .sType = VK_STRUCTURE_TYPE_VIDEO_ENCODE_INFO_KHR,
    .pNext = &amp;intraRefreshInfo,
    .flags = VK_VIDEO_ENCODE_INTRA_REFRESH_BIT_KHR, // this is an intra refresh frame
    ...
    .referenceSlotCount = 1,
    .pReferenceSlots = &amp;referenceSlotInfo
};

vkCmdEncodeVideoKHR(commandBuffer, &amp;encodeInfo);

vkCmdEndVideoCodingKHR(commandBuffer, ...);</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_issues"><a class="anchor" href="#_issues"></a>5. Issues</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_resolved_is_intra_refresh_performed_per_slice_segment"><a class="anchor" href="#_resolved_is_intra_refresh_performed_per_slice_segment"></a>5.1. RESOLVED: Is intra refresh performed per slice (segment)?</h3>
<div class="paragraph">
<p>Not necessarily. While certain implementations may (only) support intra refresh on a per slice (segment) basis, this proposal does not require that.</p>
</div>
</div>
<div class="sect2">
<h3 id="_resolved_are_the_actual_extents_of_intra_refresh_regions_exposed_to_the_application"><a class="anchor" href="#_resolved_are_the_actual_extents_of_intra_refresh_regions_exposed_to_the_application"></a>5.2. RESOLVED: Are the actual extents of intra refresh regions exposed to the application?</h3>
<div class="paragraph">
<p>No. There are too many implementation variations when it comes to intra refresh:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Some may support intra refresh per slice (segment)</p>
</li>
<li>
<p>Some may support intra refresh per coding block column(s) / row(s)</p>
</li>
<li>
<p>Some may support intra refresh according to other grouping of coding blocks</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_resolved_should_we_require_the_slice_segment_count_to_match_used_the_intra_refresh_cycle_duration"><a class="anchor" href="#_resolved_should_we_require_the_slice_segment_count_to_match_used_the_intra_refresh_cycle_duration"></a>5.3. RESOLVED: Should we require the slice (segment) count to match used the intra refresh cycle duration?</h3>
<div class="paragraph">
<p>Yes, at least when the selected intra refresh mode is per slice (segment) intra refresh.</p>
</div>
</div>
<div class="sect2">
<h3 id="_resolved_should_we_provide_a_query_for_the_application_to_determine_the_location_and_extent_of_intra_refresh_regions"><a class="anchor" href="#_resolved_should_we_provide_a_query_for_the_application_to_determine_the_location_and_extent_of_intra_refresh_regions"></a>5.4. RESOLVED: Should we provide a query for the application to determine the location and extent of intra refresh regions?</h3>
<div class="paragraph">
<p>Not in this extension. It is not even clear how such a query could look like, considering that intra refresh regions may not be rectangular on some implementations and may not consist of subsequent coding blocks on other implementations. A general query therefore is difficult to provide.</p>
</div>
</div>
<div class="sect2">
<h3 id="_resolved_can_specific_intra_refresh_regions_for_a_given_coded_extent_and_intra_refresh_cycle_duration_be_empty"><a class="anchor" href="#_resolved_can_specific_intra_refresh_regions_for_a_given_coded_extent_and_intra_refresh_cycle_duration_be_empty"></a>5.5. RESOLVED: Can specific intra refresh regions for a given coded extent and intra refresh cycle duration be empty?</h3>
<div class="paragraph">
<p>Yes. This is necessary to account for implementation-specific limitations on how a specific coded extent can be split into intra refresh regions for a particular video codec operation and encoder configuration.</p>
</div>
</div>
<div class="sect2">
<h3 id="_resolved_should_we_enforce_with_valid_usage_clauses_that_the_intra_refresh_cycle_is_completed_in_exactly_intrarefreshcycleduration_number_of_frames_with_subsequent_intrarefreshindex_values"><a class="anchor" href="#_resolved_should_we_enforce_with_valid_usage_clauses_that_the_intra_refresh_cycle_is_completed_in_exactly_intrarefreshcycleduration_number_of_frames_with_subsequent_intrarefreshindex_values"></a>5.6. RESOLVED: Should we enforce with valid usage clauses that the intra refresh cycle is completed in exactly <code>intraRefreshCycleDuration</code> number of frames with subsequent <code>intraRefreshIndex</code> values?</h3>
<div class="paragraph">
<p>No. While this is the typical use case, this proposal does not restrict applications from attempting to use more complex patterns. Instead, the proposal only defines the rules for intra refresh and reference prediction restriction. However, if the provided controls are used incorrectly, the resulting bitstream may not be resilient to error propagation, as likely intended.</p>
</div>
</div>
<div class="sect2">
<h3 id="_resolved_should_we_restrict_referencing_during_an_intra_refresh_cycle_to_the_previously_encoded_frame"><a class="anchor" href="#_resolved_should_we_restrict_referencing_during_an_intra_refresh_cycle_to_the_previously_encoded_frame"></a>5.7. RESOLVED: Should we restrict referencing during an intra refresh cycle to the previously encoded frame?</h3>
<div class="paragraph">
<p>Yes. While some implementations can support unrestricted referencing of pictures with dirty intra refresh regions, such functionality is left to a future extension.</p>
</div>
</div>
<div class="sect2">
<h3 id="_resolved_are_there_any_restrictions_on_the_encoded_picture_types_that_can_be_used_with_intra_refresh"><a class="anchor" href="#_resolved_are_there_any_restrictions_on_the_encoded_picture_types_that_can_be_used_with_intra_refresh"></a>5.8. RESOLVED: Are there any restrictions on the encoded picture types that can be used with intra refresh?</h3>
<div class="paragraph">
<p>Some implementations are not able to produce H.264 and/or H.265 B picture syntax when intra refresh is used. This applies both to B pictures encoded with intra refresh and to B pictures referencing pictures encoded with intra refresh (i.e. reference pictures having dirty intra refresh regions).
Accordingly, optional H.264 and H.265 encode capability flags are introduced to indicate support for encoding B pictures with intra refresh.
Similar restrictions exist for AV1 encode on some implementations where using compound prediction modes is incompatible with intra refresh, so another optional AV1 encode capability flag is introduced to indicate support for encoding using compound prediction mode with intra refresh.</p>
</div>
</div>
<div class="sect2">
<h3 id="_resolved_should_we_allow_pictures_encoded_without_intra_refresh_to_have_active_reference_pictures_with_dirty_intra_refresh_regions"><a class="anchor" href="#_resolved_should_we_allow_pictures_encoded_without_intra_refresh_to_have_active_reference_pictures_with_dirty_intra_refresh_regions"></a>5.9. RESOLVED: Should we allow pictures encoded without intra refresh to have active reference pictures with dirty intra refresh regions?</h3>
<div class="paragraph">
<p>No. Not all implementations seem to support this and it is not a requirement for typical intra refresh use cases.</p>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<script id="site-script" src="../../../../_/js/site.js" data-ui-root-path="../../../../_"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
<script src="../../../../_/js/vendor/split.js"></script>
<script>
    // Splitter should only be visible in non-mobile layouts (where a hamburger menu is used for nav)
    var width = (window.innerWidth > 0) ? window.innerWidth : screen.width;
    var mobileNav = (width < 1024);

    if (!mobileNav) {
        var sizes = localStorage.getItem('split-sizes')

        if (sizes) {
            sizes = JSON.parse(sizes)
        } else {
            sizes = [25, 75]
        }

        var split = Split(['#split-0', '#split-1'], {
            sizes: sizes,
            onDragEnd: function (sizes) {
                localStorage.setItem('split-sizes', JSON.stringify(sizes))
            },
        })
    }
</script>
<script src="../../../../_/js/vendor/lunr.js" defer></script>
<script src="https://cdn.jsdelivr.net/pako/1.0.3/pako.min.js" defer></script>
<script src="../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../.." data-snippet-length="100" data-stylesheet="../../../../_/css/search.css" defer></script>
<script>
window.addEventListener('DOMContentLoaded', function(){
  try {
    var script = document.getElementById('search-ui-script');
    var siteRoot = (script && script.getAttribute('data-site-root-path')) || '';
    var manifestUrl = siteRoot + '/search-index/manifest.json';
    fetch(manifestUrl)
      .then(function (r) { return r.ok ? r.json() : Promise.reject(new Error('manifest not found')) })
      .then(function (manifest) { antoraSearch.bootstrap(lunr, manifest, siteRoot); })
      .catch(function () {
        var s = document.createElement('script');
        s.async = true;
        s.src = siteRoot + '/search-index.js';
        document.head.appendChild(s);
      });
  } catch (e) {
    // Fallback to monolithic index if anything goes wrong
    var s = document.createElement('script');
    s.async = true;
    s.src = '../../../../search-index.js';
    document.head.appendChild(s);
  }
});
</script>
<script async src="../../../../_/js/vendor/tabs.js"></script>
  </body>
</html>
