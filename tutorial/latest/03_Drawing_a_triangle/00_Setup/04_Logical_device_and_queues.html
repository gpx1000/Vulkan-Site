<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Logical device and queues :: Vulkan Documentation Project</title>
    <meta name="generator" content="Antora 3.1.10">
    <link rel="stylesheet" href="../../../../_/css/site.css">
    <script>var uiRootPath = '../../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../../..">Vulkan Documentation Project</a>
      <div class="navbar-item">
        <img alt="Vulkan White Label" src="../../../../_/Vulkan_White_Dec16.svg" height="100%" />
      </div>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <label for="search-input"></label><input id="search-input" type="text" placeholder="Search the docs">
        </div>
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <!-- <a class="navbar-item" href="#">Home</a> -->
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Specs</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="../../../../spec/latest/chapters/introduction.html">Vulkan 1.3</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Guides</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="../../../../guide/latest/index.html">Vulkan Guide</a>
          </div>
        </div>
            <!--
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Tools</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">TBD</a>
          </div>
        </div>
            -->
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Tutorial</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="../../../../tutorial/latest/index.html">Vulkan Tutorial</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Samples</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="../../../../samples/latest/README.html">Vulkan Samples</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Help</a>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="https://discord.gg/vulkan">Vulkan Discord</a>
            <a class="navbar-item" href="https://khr.io/khrdiscord">Khronos Discord</a>
          </div>
        </div>
            <!--
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
            -->
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="tutorial" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../00_Introduction.html">Khronos Vulkan Tutorial</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../00_Introduction.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../01_Overview.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../02_Development_environment.html">Development environment</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="00_Base_code.html">Drawing a triangle</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="00_Base_code.html">Setup</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="00_Base_code.html">Base Code</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="01_Instance.html">Instance</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="02_Validation_layers.html">Validation layers</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="03_Physical_devices_and_queue_families.html">Physical devices and queue families</a>
  </li>
  <li class="nav-item is-current-page" data-depth="3">
    <a class="nav-link" href="04_Logical_device_and_queues.html">Logical device and queues</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../01_Presentation/00_Window_surface.html">Presentation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../01_Presentation/00_Window_surface.html">Window surface</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../01_Presentation/01_Swap_chain.html">Swap chain</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../01_Presentation/02_Image_views.html">Image views</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../02_Graphics_pipeline_basics/00_Introduction.html">Graphics pipeline basics</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../02_Graphics_pipeline_basics/00_Introduction.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../02_Graphics_pipeline_basics/01_Shader_modules.html">Shader modules</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../02_Graphics_pipeline_basics/02_Fixed_functions.html">Fixed functions</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../02_Graphics_pipeline_basics/03_Render_passes.html">Render passes</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../02_Graphics_pipeline_basics/04_Conclusion.html">Conclusion</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../03_Drawing/00_Framebuffers.html">Drawing</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../03_Drawing/00_Framebuffers.html">Framebuffers</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../03_Drawing/01_Command_buffers.html">Command buffers</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../03_Drawing/02_Rendering_and_presentation.html">Rendering and presentation</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../03_Drawing/03_Frames_in_flight.html">Frames in flight</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../04_Swap_chain_recreation.html">Swap chain recreation</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../04_Vertex_buffers/00_Vertex_input_description.html">Vertex buffers</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../04_Vertex_buffers/00_Vertex_input_description.html">Vertex input description</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../04_Vertex_buffers/01_Vertex_buffer_creation.html">Vertex buffer creation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../04_Vertex_buffers/02_Staging_buffer.html">Staging buffer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../04_Vertex_buffers/03_Index_buffer.html">Index buffer</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../05_Uniform_buffers/00_Descriptor_set_layout_and_buffer.html">Uniform buffers</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../05_Uniform_buffers/00_Descriptor_set_layout_and_buffer.html">Descriptor layout and buffer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../05_Uniform_buffers/01_Descriptor_pool_and_sets.html">Descriptor pool and sets</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../06_Texture_mapping/00_Images.html">Texture mapping</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../06_Texture_mapping/00_Images.html">Images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../06_Texture_mapping/01_Image_view_and_sampler.html">Image view and sampler</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../06_Texture_mapping/02_Combined_image_sampler.html">Combined image sampler</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../07_Depth_buffering.html">Depth buffering</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../08_Loading_models.html">Loading models</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../09_Generating_Mipmaps.html">Generating Mipmaps</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../10_Multisampling.html">Multisampling</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../11_Compute_Shader.html">Compute Shader</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../12_Ecosystem_Utilities_and_Compatibility.html">Ecosystem Utilities and GPU Compatibility</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../13_Vulkan_Profiles.html">Vulkan Profiles</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../14_Android.html">Android</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../15_GLTF_KTX2_Migration.html">Migrating to Modern Asset Formats: glTF and KTX2</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../16_Multiple_Objects.html">Rendering Multiple Objects</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../17_Multithreading.html">Multithreading</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../courses/18_Ray_tracing/00_Overview.html">Ray Tracing</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../courses/18_Ray_tracing/00_Overview.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../courses/18_Ray_tracing/01_Dynamic_rendering.html">Dynamic rendering</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../courses/18_Ray_tracing/02_Acceleration_structures.html">Acceleration structures</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../courses/18_Ray_tracing/03_Ray_query_shadows.html">Ray query shadows</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../courses/18_Ray_tracing/04_TLAS_animation.html">TLAS animation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../courses/18_Ray_tracing/05_Shadow_transparency.html">Shadow transparency</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../courses/18_Ray_tracing/06_Reflections.html">Reflections</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../courses/18_Ray_tracing/07_Conclusion.html">Conclusion</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../90_FAQ.html">FAQ</a>
  </li>
  <li class="nav-item" data-depth="1">
    <span class="nav-text"><a href="https://github.com/KhronosGroup/Vulkan-Tutorial" target="_blank" rel="noopener">GitHub Repository</a></span>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Khronos Vulkan Tutorial</span>
    <span class="version">latest</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../../00_Introduction.html">Khronos Vulkan Tutorial</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../00_Introduction.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../glsl/latest/index.html">OpenGL Shading Language Specification</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../glsl/latest/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../refpages/latest/refpages/index.html">Vulkan API Reference Pages</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../refpages/latest/refpages/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../features/latest/features/index.html">Vulkan Feature Descriptions</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../features/latest/features/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../guide/latest/index.html">Vulkan Guide</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../guide/latest/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../samples/latest/README.html">Vulkan Samples</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../samples/latest/README.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../../spec/latest/index.html">Vulkan Specification</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../../spec/latest/index.html">latest</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../../spec/latest/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../00_Introduction.html">Khronos Vulkan Tutorial</a></li>
    <li><a href="00_Base_code.html">Drawing a triangle</a></li>
    <li><a href="00_Base_code.html">Setup</a></li>
    <li><a href="04_Logical_device_and_queues.html">Logical device and queues</a></li>
  </ul>
</nav>
    <!--
    -->
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Logical device and queues</h1>
<div class="sect1">
<h2 id="_introduction"><a class="anchor" href="#_introduction"></a>Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After selecting a physical device to use, we need to set up a <strong>logical device</strong> to
interface with it. The logical device creation process is similar to the
instance creation process and describes the features we want to use. We also
need to specify which queues to create now that we&#8217;ve queried which queue
families are available. You can even create multiple logical devices from the
same physical device if you have varying requirements.</p>
</div>
<div class="paragraph">
<p>Start by adding a new class member to store the logical device handle in.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">vk::raii::Device device = nullptr;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, add a <code>createLogicalDevice</code> function that is called from <code>initVulkan</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">void initVulkan() {
    createInstance();
    setupDebugMessenger();
    pickPhysicalDevice();
    createLogicalDevice();
}

void createLogicalDevice() {

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_specifying_the_queues_to_be_created"><a class="anchor" href="#_specifying_the_queues_to_be_created"></a>Specifying the queues to be created</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The creation of a logical device involves specifying a bunch of details in
structs again, of which the first one will be <code>VkDeviceQueueCreateInfo</code>. This
structure describes the number of queues we want for a single queue family.
Right now we&#8217;re only interested in a queue with graphics capabilities.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">std::vector&lt;vk::QueueFamilyProperties&gt; queueFamilyProperties = physicalDevice.getQueueFamilyProperties();
uint32_t graphicsIndex = findQueueFamilies(m_physicalDevice);
vk::DeviceQueueCreateInfo deviceQueueCreateInfo { .queueFamilyIndex = graphicsIndex };</code></pre>
</div>
</div>
<div class="paragraph">
<p>The currently available drivers will only allow you to create a small number of
queues for each queue family, and you don&#8217;t really need more than one. That&#8217;s
because you can create all the command buffers on multiple threads and then
submit them all at once on the main thread with a single low-overhead call.</p>
</div>
<div class="paragraph">
<p>Vulkan lets you assign priorities to queues to influence the scheduling of
command buffer execution using floating point numbers between <code>0.0</code> and <code>1.0</code>.
This is required even if there is only a single queue:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">float queuePriority = 0.5f;
vk::DeviceQueueCreateInfo deviceQueueCreateInfo { .queueFamilyIndex = graphicsIndex, .queueCount = 1, .pQueuePriorities = &amp;queuePriority };</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_specifying_used_device_features"><a class="anchor" href="#_specifying_used_device_features"></a>Specifying used device features</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The next information to specify is the set of device features that we&#8217;ll be
using. These are the features that we queried support for with
<code>vkGetPhysicalDeviceFeatures</code> in the previous chapter, like geometry shaders.
Right now we don&#8217;t need anything special, so we can simply define it and leave
everything to <code>VK_FALSE</code>. We&#8217;ll come back to this structure once we&#8217;re about to
start doing more interesting things with Vulkan.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">vk::PhysicalDeviceFeatures deviceFeatures;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_enabling_additional_device_features"><a class="anchor" href="#_enabling_additional_device_features"></a>Enabling additional device features</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Vulkan is designed to be backwards compatible, which means that by default, you only get access to the basic features that were available in Vulkan 1.0. To use newer features, you need to explicitly request them during device creation.</p>
</div>
<div class="paragraph">
<p>In Vulkan, features are organized into different structures based on when they were introduced or what functionality they relate to. For example:
- Basic features are in <code>vk::PhysicalDeviceFeatures</code>
- Vulkan 1.3 features are in <code>vk::PhysicalDeviceVulkan13Features</code>
- Extension-specific features are in their own structures (like <code>vk::PhysicalDeviceExtendedDynamicStateFeaturesEXT</code>)</p>
</div>
<div class="paragraph">
<p>To enable multiple sets of features, Vulkan uses a concept called "structure chaining." Each feature structure has a <code>pNext</code> field that can point to another structure, creating a chain of feature requests.</p>
</div>
<div class="paragraph">
<p>The C++ Vulkan API provides a helper template called <code>vk::StructureChain</code> that makes this process easier. Let&#8217;s see how to use it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">// Create a chain of feature structures
vk::StructureChain&lt;vk::PhysicalDeviceFeatures2, vk::PhysicalDeviceVulkan13Features, vk::PhysicalDeviceExtendedDynamicStateFeaturesEXT&gt; featureChain = {
    {},                               // vk::PhysicalDeviceFeatures2 (empty for now)
    {.dynamicRendering = true },      // Enable dynamic rendering from Vulkan 1.3
    {.extendedDynamicState = true }   // Enable extended dynamic state from the extension
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here&#8217;s what&#8217;s happening in this code:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>We create a <code>vk::StructureChain</code> with three different feature structures.</p>
</li>
<li>
<p>For each structure in the chain, we provide an initializer:</p>
<div class="ulist">
<ul>
<li>
<p>The first structure (<code>vk::PhysicalDeviceFeatures2</code>) is left empty with <code>{}</code></p>
</li>
<li>
<p>In the second structure, we enable the <code>dynamicRendering</code> feature from Vulkan 1.3</p>
</li>
<li>
<p>In the third structure, we enable the <code>extendedDynamicState</code> feature from an extension</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>vk::StructureChain</code> template automatically connects these structures together by setting up the <code>pNext</code> pointers between them. This saves us from having to manually link each structure to the next one.</p>
</div>
<div class="paragraph">
<p>When we create the logical device later, we&#8217;ll pass a pointer to the first structure in this chain, which will allow Vulkan to see all the features we want to enable.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_specifying_device_extensions"><a class="anchor" href="#_specifying_device_extensions"></a>Specifying device extensions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For our application to work properly, we need to enable certain device extensions. These extensions provide additional functionality that we&#8217;ll need later in the tutorial.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">std::vector&lt;const char*&gt; deviceExtensions = {
    vk::KHRSwapchainExtensionName,
    vk::KHRSpirv14ExtensionName,
    vk::KHRSynchronization2ExtensionName,
    vk::KHRCreateRenderpass2ExtensionName
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>VK_KHR_swapchain</code> extension is required for presenting rendered images to the window. The other extensions provide additional functionality that we&#8217;ll use in later parts of the tutorial.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_creating_the_logical_device"><a class="anchor" href="#_creating_the_logical_device"></a>Creating the logical device</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With all the necessary information prepared, we can now create the logical device. We need to fill in the <code>vk::DeviceCreateInfo</code> structure and connect our feature chain to it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">vk::DeviceCreateInfo deviceCreateInfo{
    .pNext = &amp;featureChain.get&lt;vk::PhysicalDeviceFeatures2&gt;(),
    .queueCreateInfoCount = 1,
    .pQueueCreateInfos = &amp;deviceQueueCreateInfo,
    .enabledExtensionCount = static_cast&lt;uint32_t&gt;(deviceExtensions.size()),
    .ppEnabledExtensionNames = deviceExtensions.data()
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>Reviewing how we connect our feature chain to the device creation process:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The <code>featureChain.get&lt;vk::PhysicalDeviceFeatures2&gt;()</code> method retrieves a reference to the first structure in our chain (the <code>vk::PhysicalDeviceFeatures2</code> structure).</p>
</li>
<li>
<p>We assign this reference to the <code>pNext</code> field of the <code>deviceCreateInfo</code> structure.</p>
</li>
<li>
<p>Since all the structures in our feature chain are already connected (thanks to <code>vk::StructureChain</code>), Vulkan will be able to see all the features we want to enable by following the chain of <code>pNext</code> pointers.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This approach allows us to request multiple sets of features in a clean and organized way. Vulkan will process each structure in the chain and enable the requested features during device creation.</p>
</div>
<div class="paragraph">
<p>The remainder of the information bears a resemblance to the
<code>VkInstanceCreateInfo</code> struct and requires you to specify extensions and
validation layers. The difference is that these are device-specific this time.</p>
</div>
<div class="paragraph">
<p>An example of a device-specific extension is <code>VK_KHR_swapchain</code>, which allows
you to present rendered images from that device to windows. It is possible that
there are Vulkan devices in the system that lack this ability, for example,
because they only support compute operations. We will come back to this
extension in the swap chain chapter.</p>
</div>
<div class="paragraph">
<p>Previous implementations of Vulkan made a distinction between instance and
device-specific validation layers, but this is
<a href="https://docs.vulkan.org/spec/latest/chapters/raytracing.html#extendingvulkan-layers-devicelayerdeprecation">no longer the case</a>.
That means that the <code>enabledLayerCount</code> and <code>ppEnabledLayerNames</code> fields of
<code>VkDeviceCreateInfo</code> are ignored by up-to-date implementations.</p>
</div>
<div class="paragraph">
<p>As mentioned earlier, we need several device-specific extensions for our application to work properly.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">device = vk::raii::Device( physicalDevice, deviceCreateInfo );</code></pre>
</div>
</div>
<div class="paragraph">
<p>The parameters are the physical device to interface with, and the usage
info we just specified, the optional allocation callbacks pointer and a pointer
to a variable to store the logical device handle in. Similarly to the instance
creation function, this call can throw errors based on enabling non-existent
extensions or specifying the desired usage of unsupported features.</p>
</div>
<div class="paragraph">
<p>Logical devices don&#8217;t interact directly with instances, which is why it&#8217;s not
included as a parameter.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_retrieving_queue_handles"><a class="anchor" href="#_retrieving_queue_handles"></a>Retrieving queue handles</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The queues are automatically created along with the logical device, but we don&#8217;t have a handle to interface with them yet.
First, add a class member to store a handle to the graphics queue:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">vk::raii::Queue graphicsQueue;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Device queues are implicitly cleaned up when the device is destroyed, so we
don&#8217;t need to do anything in <code>cleanup</code>.</p>
</div>
<div class="paragraph">
<p>We can use the <code>vkGetDeviceQueue</code> function to retrieve queue handles for each
queue family. The parameters are the logical device, queue family, queue index
and a pointer to the variable to store the queue handle in. Because we&#8217;re only
creating a single queue from this family, we&#8217;ll simply use index <code>0</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-c++ hljs" data-lang="c++">graphicsQueue = vk::raii::Queue( device, graphicsIndex, 0 );</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the logical device and queue handles, we can now actually start using the
graphics card to do things! In the
<a href="../01_Presentation/00_Window_surface.html" class="xref page">next few chapters</a>, we&#8217;ll set
 up the resources to present results to the window system.</p>
</div>
<div class="paragraph">
<p><a href="../../_attachments/04_logical_device.cpp">C&#43;&#43; code</a></p>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
    <!--
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
    -->
</footer>
<script id="site-script" src="../../../../_/js/site.js" data-ui-root-path="../../../../_"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
<script src="../../../../_/js/vendor/lunr.js" defer></script>
<script src="https://cdn.jsdelivr.net/pako/1.0.3/pako.min.js" defer></script>
<script src="../../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../../.." data-snippet-length="100" data-stylesheet="../../../../_/css/search.css" defer></script>
<script>
window.addEventListener('DOMContentLoaded', function(){
  try {
    var script = document.getElementById('search-ui-script');
    var siteRoot = (script && script.getAttribute('data-site-root-path')) || '';
    var manifestUrl = siteRoot + '/search-index/manifest.json';
    fetch(manifestUrl)
      .then(function (r) { return r.ok ? r.json() : Promise.reject(new Error('manifest not found')) })
      .then(function (manifest) { antoraSearch.bootstrap(lunr, manifest, siteRoot); })
      .catch(function () {
        var s = document.createElement('script');
        s.async = true;
        s.src = siteRoot + '/search-index.js';
        document.head.appendChild(s);
      });
  } catch (e) {
    // Fallback to monolithic index if anything goes wrong
    var s = document.createElement('script');
    s.async = true;
    s.src = '../../../../search-index.js';
    document.head.appendChild(s);
  }
});
</script>
  </body>
</html>
